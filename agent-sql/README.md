# SQL Agent 튜토리얼

이 폴더에는 LangGraph를 사용하여 SQL Agent를 구현하는 두 가지 레벨의 튜토리얼이 포함되어 있습니다.

## 파일 구성

### 1. `01_basic_sql_agent.py` - 기본 버전
Agent와 LangGraph의 기본기를 알고 있는 학생들을 위한 입문 수준의 SQL Agent입니다.

**주요 특징:**
- 간단한 상태 관리 (메시지만 추적)
- 기본적인 SQL 쿼리 실행 도구
- 단순한 워크플로우 (질문 → 쿼리 생성 → 실행 → 응답)
- 기본적인 오류 처리

**학습 목표:**
- SQL 데이터베이스와 상호작용하는 기본적인 Agent 구조 이해
- LangGraph를 사용한 간단한 워크플로우 구현
- SQL 도구 사용법 및 오류 처리 기초

### 2. `02_advanced_sql_agent.py` - 실무 수준 버전
기본 SQL Agent를 이해한 학생들을 위한 실무에서 사용할 수 있는 고급 버전입니다.

**주요 특징:**
- 고급 상태 관리 (테이블 정보, 시도 횟수, 오류 이력, 실행 로그)
- 단계별 워크플로우 (테이블 조회 → 스키마 분석 → 쿼리 생성 → 검증 → 실행)
- SQL 쿼리 검증 시스템
- 향상된 오류 처리 및 재시도 메커니즘
- 성능 모니터링 (실행 시간 측정)
- 보안 강화 (DML 쿼리 차단)
- 구조화된 응답 생성

**학습 목표:**
- 복잡한 워크플로우 설계 및 구현
- 프로덕션 레벨의 오류 처리 및 보안 고려사항
- 성능 모니터링 및 로깅 시스템 구현
- 실무에서 요구되는 검증 및 안전성 확보

## 사전 요구사항

### 필수 패키지
```bash
pip install langchain langgraph langchain-openai langchain-community python-dotenv
```

### 환경 변수 설정
`.env` 파일을 생성하고 OpenAI API 키를 설정하세요:
```
OPENAI_API_KEY=your_openai_api_key_here
```

### 데이터베이스
두 파일 모두 Chinook 샘플 데이터베이스를 자동으로 다운로드하여 사용합니다.
- 음악 스토어 데이터베이스
- 주요 테이블: Artist, Album, Track, Customer, Invoice, Employee 등

## 실행 방법

### 기본 버전 실행
```bash
cd ssp/agent-sql
python 01_basic_sql_agent.py
```

### 고급 버전 실행
```bash
cd ssp/agent-sql
python 02_advanced_sql_agent.py
```

## 주요 차이점 비교

| 기능 | 기본 버전 | 고급 버전 |
|------|-----------|-----------|
| **상태 관리** | 메시지만 추적 | 테이블, 시도횟수, 로그 등 상세 추적 |
| **워크플로우** | 단순 (질문→쿼리→실행) | 단계별 (테이블조회→스키마→쿼리→검증→실행) |
| **오류 처리** | 기본적인 try-catch | 재시도 메커니즘, 오류 이력 관리 |
| **쿼리 검증** | 없음 | LLM 기반 쿼리 검증 시스템 |
| **보안** | 기본적인 예외 처리 | DML 쿼리 차단, 안전한 실행 |
| **모니터링** | 없음 | 실행 시간 측정, 상세 로깅 |
| **사용자 경험** | 기본적인 출력 | 단계별 진행상황, 통계 정보 |
| **확장성** | 제한적 | 모듈화된 구조, 쉬운 확장 |

## 예제 질문들

두 Agent 모두 다음과 같은 질문들을 처리할 수 있습니다:

### 기본 질문
- "데이터베이스에 어떤 테이블들이 있나요?"
- "가장 인기 있는 아티스트 10명을 보여주세요"
- "2009년에 총 얼마의 매출이 있었나요?"

### 복합 질문 (고급 버전에서 더 잘 처리됨)
- "2009년에 가장 많은 매출을 올린 국가는 어디이고, 얼마를 벌었나요?"
- "가장 인기 있는 음악 장르 5개와 각각의 판매량을 알려주세요"
- "직원별 2009년 매출 실적을 내림차순으로 정렬해서 보여주세요"

## 학습 순서 권장사항

1. **첫 번째 단계**: `01_basic_sql_agent.py`를 실행하고 코드를 분석
   - 기본적인 Agent 구조 이해
   - LangGraph의 기본 워크플로우 파악
   - 간단한 도구 사용법 학습

2. **두 번째 단계**: `02_advanced_sql_agent.py`를 실행하고 비교 분석
   - 복잡한 상태 관리 방법 학습
   - 단계별 워크플로우 설계 이해
   - 실무 수준의 오류 처리 및 보안 고려사항 학습

3. **세 번째 단계**: 커스터마이징 및 확장
   - 자신만의 도구 추가
   - 새로운 데이터베이스 연결
   - 추가적인 검증 로직 구현

## 트러블슈팅

### 일반적인 문제들

1. **데이터베이스 다운로드 실패**
   - 인터넷 연결 확인
   - 방화벽 설정 확인

2. **API 키 오류**
   - `.env` 파일 경로 확인
   - OPENAI_API_KEY 값 검증

3. **패키지 버전 충돌**
   - 최신 버전으로 업그레이드
   - 가상환경 사용 권장

## 추가 학습 자료

- [LangGraph 공식 문서](https://langchain-ai.github.io/langgraph/)
- [LangChain SQL Agent 가이드](https://python.langchain.com/docs/use_cases/sql)
- [SQLite 튜토리얼](https://www.sqlitetutorial.net/)

## 기여하기

이 튜토리얼을 개선하고 싶으시다면:
1. 버그 리포트 또는 기능 제안
2. 코드 리뷰 및 최적화 제안
3. 추가 예제 또는 사용 사례 제공

---

**참고**: 이 튜토리얼은 교육 목적으로 제작되었으며, 프로덕션 환경에서 사용하기 전에 추가적인 보안 검토와 최적화가 필요할 수 있습니다.
